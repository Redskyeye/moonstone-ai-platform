---
title: 主题系统实现
issue_id: 003
status: ready
priority: high
assigned_to: unassigned
created: 2025-10-27T00:07:52Z
last_updated: 2025-10-27T00:07:52Z
version: 1.0
author: Claude Code PM System
epic: new
labels: ["task", "theme", "ui"]
parallel: true
depends_on: []
estimated_hours: 5
story_points: 3
---

## 任务003：主题系统实现

### 描述
实现完整的亮色/暗色主题切换系统，使用next-themes库提供无缝的主题切换体验。包括主题状态管理、系统偏好检测、主题持久化存储和过渡动画效果。

### 验收标准
- [ ] 集成next-themes库，配置主题提供者
- [ ] 实现亮色（light）和暗色（dark）两种主题模式
- [ ] 支持系统主题自动检测和跟随
- [ ] 主题状态在页面刷新和会话间持久化
- [ ] 创建主题切换UI组件（Toggle Button或Dropdown）
- [ ] 实现平滑的主题切换过渡动画
- [ ] 确保所有UI组件在两种主题下都能正常显示
- [ ] 支持SSR（服务器端渲染），避免闪烁问题
- [ ] 添加主题相关的TypeScript类型定义

### 技术细节
- 使用next-themes v0.2.x作为主题管理库
- CSS变量实现主题颜色系统
- Tailwind CSS dark mode配置
- 自定义主题切换组件
- 使用localStorage持久化主题设置
- 支持系统偏好检测（`prefers-color-scheme`）

#### 主题配置结构：
```typescript
// themes/index.ts
export const themes = {
  light: {
    background: 'hsl(0 0% 100%)',
    foreground: 'hsl(222.2 84% 4.9%)',
    // ... 更多颜色定义
  },
  dark: {
    background: 'hsl(222.2 84% 4.9%)',
    foreground: 'hsl(210 40% 98%)',
    // ... 更多颜色定义
  }
} as const;
```

#### Tailwind CSS配置：
```javascript
// tailwind.config.js
module.exports = {
  darkMode: ['class'],
  theme: {
    extend: {
      colors: {
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        // ... 更多CSS变量映射
      }
    }
  }
}
```

#### 主题切换组件API：
```typescript
interface ThemeToggleProps {
  variant?: 'default' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  showLabel?: boolean;
  className?: string;
}
```

### 依赖关系
- Next.js 14项目已初始化（任务002）
- TypeScript配置完成（任务002）
- Tailwind CSS配置（任务002的一部分）

### 工作量估算
- **next-themes集成**：1小时
- **主题颜色系统设计**：1小时
- **Tailwind CSS暗色模式配置**：1小时
- **主题切换组件开发**：1小时
- **过渡动画实现**：0.5小时
- **SSR优化和测试**：0.5小时
- **总计**：5小时

### 完成标准
1. ✅ 主题切换功能正常工作，无UI闪烁
2. ✅ 系统主题检测功能正常
3. ✅ 主题设置在页面刷新后保持
4. ✅ 所有组件在两种主题下视觉一致
5. ✅ 主题切换动画流畅自然
6. ✅ SSR渲染正常，无hydration错误
7. ✅ 代码类型安全，无TypeScript错误
8. ✅ 在不同设备和浏览器上测试通过

### 验证命令
```bash
# 检查主题切换功能
npm run dev
# 访问 http://localhost:3000 测试主题切换

# TypeScript类型检查
npm run type-check

# 构建测试（确保SSR正常）
npm run build
npm run start

# 检查主题持久化
# 1. 切换主题
# 2. 刷新页面
# 3. 检查主题是否保持
```

### 主题提供者设置：
```typescript
// app/providers.tsx
'use client';

import { ThemeProvider } from 'next-themes';

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <ThemeProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </ThemeProvider>
  );
}
```

### 使用示例：
```typescript
// 在组件中使用主题
import { useTheme } from 'next-themes';

export function ThemeToggle() {
  const { theme, setTheme } = useTheme();

  return (
    <button
      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
    >
      切换到 {theme === 'dark' ? '亮色' : '暗色'} 主题
    </button>
  );
}
```

### 备注
主题系统是用户体验的重要组成部分，确保实现细节完善。特别注意SSR场景下的闪烁问题，使用next-themes提供的解决方案。主题切换应该是即时响应的，给用户流畅的体验。颜色对比度要符合WCAG标准，确保可访问性。
