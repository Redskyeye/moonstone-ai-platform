---
title: N8N Webhook集成
issue_id: 006
status: ready
priority: high
assigned_to: unassigned
created: 2025-10-26T16:07:52Z
last_updated: 2025-10-26T16:07:52Z
version: 1.0
author: Claude Code PM System
epic: new
labels: ["task", "api", "backend", "n8n"]
parallel: true
depends_on: []
estimated_hours: 10
story_points: 6
---

## 任务006：N8N Webhook集成

### 描述
封装N8N自动化服务，实现简历解析和优化的API调用接口。这是第二阶段的核心后端任务，为前端提供稳定可靠的AI处理服务支撑。

### 验收标准
- [ ] 创建N8N服务客户端，支持Webhook调用
- [ ] 实现简历文件上传接口（支持PDF/DOCX）
- [ ] 封装简历解析API调用服务
- [ ] 实现简历优化API调用服务
- [ ] 创建API错误处理和重试机制
- [ ] 实现请求限流和并发控制
- [ ] 添加API响应缓存机制
- [ ] 创建完整的API文档和类型定义

### 技术细节
- 使用Next.js 14的Route Handlers实现API
- TypeScript严格类型定义，完整的错误处理
- 支持multipart/form-data文件上传
- 实现Webhook超时处理和状态检查
- 使用Redis或内存缓存API响应
- 完整的日志记录和监控

#### API接口结构：
```
src/app/api/
├── resume/
│   ├── upload/
│   │   └── route.ts          # 文件上传接口
│   ├── parse/
│   │   └── route.ts          # 简历解析接口
│   ├── optimize/
│   │   └── route.ts          # 简历优化接口
│   └── status/
│       └── [id]/route.ts     # 处理状态查询
├── lib/
│   ├── n8n-client.ts         # N8N客户端封装
│   ├── file-validator.ts     # 文件验证工具
│   └── api-cache.ts          # API缓存服务
└── types/
    ├── n8n.types.ts          # N8N接口类型
    └── resume.types.ts       # 简历相关类型
```

#### 核心API接口定义：
```typescript
// 文件上传接口
interface UploadResponse {
  fileId: string;
  originalName: string;
  fileSize: number;
  fileType: string;
  status: 'uploaded' | 'processing' | 'failed';
}

// 简历解析接口
interface ParseRequest {
  fileId: string;
  extractOptions: {
    contactInfo: boolean;
    experience: boolean;
    education: boolean;
    skills: boolean;
  };
}

interface ParseResponse {
  parsedData: ParsedResume;
  confidence: number;
  processingTime: number;
}

// 简历优化接口
interface OptimizeRequest {
  parsedResume: ParsedResume;
  targetRole?: string;
  optimizationLevel: 'basic' | 'advanced' | 'expert';
}

interface OptimizeResponse {
  optimizedResume: OptimizedResume;
  improvements: ResumeImprovement[];
  score: number;
  suggestions: string[];
}
```

### 依赖关系
- 项目基础架构（任务002）
- 类型系统配置（任务002）
- API路由基础（任务004）

### 工作量估算
- **N8N客户端开发**：2小时
- **文件上传API实现**：2小时
- **简历解析API封装**：2小时
- **简历优化API实现**：2小时
- **错误处理和重试机制**：1小时
- **缓存和限流实现**：1小时
- **API文档和测试**：2小时
- **总计**：10小时

### 完成标准
1. ✅ 所有API接口正常工作，响应时间<5秒
2. ✅ 文件上传支持最大10MB，类型验证正确
3. ✅ 错误处理完善，提供清晰的错误信息
4. ✅ API文档完整，包含请求/响应示例
5. ✅ 并发处理正常，不会出现资源竞争
6. ✅ 缓存机制工作正常，提升响应速度
7. ✅ 日志记录完整，便于问题排查

### 验证命令
```bash
# 启动开发服务器
npm run dev

# API接口测试
npm run test:api

# 文件上传测试
npm run test:upload

# 集成测试
npm run test:integration

# API文档生成
npm run docs:api
```

### N8N集成配置
```typescript
// N8N客户端配置
const n8nConfig = {
  webhookUrl: process.env.N8N_WEBHOOK_URL,
  apiKey: process.env.N8N_API_KEY,
  timeout: 30000, // 30秒超时
  retries: 3,
  retryDelay: 1000,
};

// 文件处理配置
const fileConfig = {
  maxSize: 10 * 1024 * 1024, // 10MB
  allowedTypes: ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],
  uploadPath: '/tmp/uploads',
};
```

### 安全考虑
- 文件类型严格验证，防止恶意文件上传
- API请求限流，防止滥用
- 敏感信息加密传输
- 文件存储安全隔离
- 请求签名验证（可选）

### 备注
N8N集成是简历处理的核心，需要确保稳定性和性能。建议在生产环境中使用专用的文件存储服务（如AWS S3）和消息队列来处理大量并发请求。密切关注N8N的响应时间和错误率，建立完善的监控告警机制。